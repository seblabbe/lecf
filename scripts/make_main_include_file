#!/usr/bin/env bash

echo "/* Warning: this file is automatically generated from the content */"
echo "/* of \"algorithms/\". Running make will destroy it                 */"
echo "#ifndef _ALL_ALGORITHMS_H"
echo "#define _ALL_ALGORITHMS_H"
echo "#include <stdio.h>"
echo "#include <stdlib.h>"
echo "#include <unistd.h>"
echo "#include <time.h>"
echo "#include <math.h>"
echo "#include <string.h>"
echo
echo "#include \"point3d.h\""
echo "#include \"random.h\""
echo "#include \"mcf_template.h\""
echo

nb=$(ls src/algorithms/*c|wc -w)

echo "#define NB_ALGORITHMS ${nb}"
echo

algos=""
descs=""
get_lexps=""
one_steps=""

for filename in src/algorithms/*c;
do
	algo=$(cat ${filename} | grep "^#define ALGORITHM_SHORT_NAME ")
	algo=${algo:29}
	desc=$(cat ${filename} | grep "^#define ALGORITHM_FULL_NAME ")
	desc=${desc:28}
	echo "void ${algo}_one_step(Point3d P);"
	echo "void ${algo}_get_lexp(double *lexp1, double *lexp2, unsigned int nb_iterations);"
	echo
	algos="${algos}XXX\"${algo}\""
	descs="${descs}XXX\"${desc}\""
	get_lexps="${get_lexps}XXX${algo}_get_lexp"
	one_steps="${one_steps}XXX${algo}_one_step"
done;

algos=${algos:3}
descs=${descs:3}
get_lexps=${get_lexps:3}
one_steps=${one_steps:3}

echo -n "static char * algo_names[${nb}] = {"
echo -n ${algos} | sed s/XXX/\,\ /g
echo "};"
echo -n "static char * descriptions[${nb}] = {"
echo -n ${descs} | sed s/XXX/\,\ /g
echo "};"
echo -n "static get_lexp_type get_lexps[${nb}] = {"
echo -n ${get_lexps} | sed s/XXX/\,\ /g
echo "};"
echo -n "static one_step_type one_steps[${nb}] = {"
echo -n ${one_steps} | sed s/XXX/\,\ /g
echo  "};"
echo "#endif"
